<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.sky.mapper.SetmealMapper">


    <select id="page" resultType="com.sky.vo.SetmealVO">
        select s.id, s.category_id, s.name, s.price, s.status, s.description, s.image,
               s.update_time, c.name from
            setmeal s
                left join category c
                on s.category_id = c.id
                <where>
                    <if test="name != null and name != ''">s.name like concat('%', #{name}, '%')</if>
                    <if test="categoryId != null">and s.category_id = #{categoryId}</if>
                    <if test="status != null">and s.status = #{status}</if>
                </where>
                order by update_time desc
    </select>

    <!-- insert --> 

    <insert id="insert" useGeneratedKeys="true" keyProperty="id">
        insert into setmeal
        (category_id, name, price, description, image, create_time, update_time, create_user, update_user, status) VALUES
            (#{categoryId}, #{name}, #{price}, #{description}, #{image}, #{createTime}, #{updateTime},#{createUser}, #{updateUser}, #{status})
    </insert>

    <!-- insertDish --> 

    <insert id="insertDish">
    insert into setmeal_dish (setmeal_id, dish_id, name, price, copies)
    values
    <foreach collection="setmealDishs" item="sd" separator=",">
        (#{sd.setmealId}, #{sd.dishId}, #{sd.name}, #{sd.price}, #{sd.copies})
    </foreach>
</insert>
</mapper>
